var MemoryGameEngine=function(){function t(t,e,s,i,n){void 0===s&&(s=-1),void 0===i&&(i=2),void 0===n&&(n="");var h=this;this.EMPTY="",this.DIV="div",this.CLICK="click",this.CREATED_EVENT_NAME=":created",this.STARTED_EVENT_NAME=":started",this.ATTEMPT_EVENT_NAME=":attempt",this.OVER_EVENT_NAME=":over",this.END_EVENT_NAME=":end",this._cssClassName="",this._picks=new Array,this._solved=new Array,this._level=2,this._resetDelay=299,this._started=0,this._ended=0,this._closeToken=-1,this._requestClose=!1,this.VERSION="1.0.0.1",this.NAME="MemoryGameEngine",this.ALIAS="mge",this.DESCRIPTION="An engine for memory game building.",this.board=document.createElement(this.DIV),this.attempts=0,this.container=t,this._cssClassName=n,this.cards=e,this._level=i,this._resetDelay=s<300?-1:s,e.forEach(function(t,e){for(var s=2;s<=h._level;s++)h.cards.push(t.cloneNode(!0))});var r=new CustomEvent(this.ALIAS+this.CREATED_EVENT_NAME);this.container.dispatchEvent(r)}return t.prototype.end=function(){this._level=2,this._resetDelay=-1,this.cards=[],this.attempts=0,this.container.innerHTML="",this.container=null},t.prototype.start=function(){var i=this;!function(r){if(r.length<=1)return;r.forEach(function(t,e){var s,i,n,h=(i=e,n=r.length-1,Math.floor(Math.random()*(n-i+1))+i);s=[r[h],r[e]],r[e]=s[0],r[h]=s[1]})}(this.cards),this.attempts=0,this.board=document.createElement(this.DIV),this.board.classList.add(this._cssClassName),this.cards.forEach(function(t,e){var s=document.createElement(i.DIV);s.tabIndex=e,i.board.appendChild(s)}),this.container.appendChild(this.board),this.board.addEventListener(this.CLICK,function(t){return i.click(t)}),this._started=(new Date).getTime();var t=new CustomEvent(this.ALIAS+this.STARTED_EVENT_NAME,{detail:this._started});this.container.dispatchEvent(t)},t.prototype.click=function(t){var e=this;-1<this._closeToken?(clearTimeout(this._closeToken),this._requestClose=!0,this.closePicks()):this._requestClose&&this.closePicks();var s=t.target;if(this._picks.length!==this._level&&(null!==(i=s).parentElement&&i.parentElement.isEqualNode(e.board))&&!(0<s.children.length)){var i,n=this.cards[s.tabIndex];this._picks.push(s.tabIndex),s.appendChild(n),this._picks.length===this._level&&this.eval()}},t.prototype.eval=function(){var s,i=this;if(this._picks.length===this._level){s=i.cards[i._picks[0]],i._picks.every(function(t,e){return s.isEqualNode(i.cards[i._picks[e]])})?i._picks.length===i._level&&(i._picks.forEach(function(t,e){i._solved.push(t)}),i._picks=new Array):this._resetDelay<300?this._requestClose=!0:this._closeToken=setTimeout(function(){i._requestClose=!0,i.closePicks()},this._resetDelay),this.attempts++}if(this.cards.length===this._solved.length){this._ended=(new Date).getTime();var t=this._ended-this._started,e=new CustomEvent(this.ALIAS+this.OVER_EVENT_NAME,{detail:{attempts:this.attempts,ellapsedMillisecods:t,displayTime:function(t,e){void 0===e&&(e=!1);var s,i,n,h;s=Math.floor(t/36e5),t%=36e5,i=Math.floor(t/6e4),t%=6e4,n=Math.floor(t/1e3),h=t%1e3;var r=function(t,e){var s="0000"+t;return s.substr(s.length-e)},a=r(s,2)+":"+r(i,2)+":"+r(n,2);return e&&(a=a+":"+r(h,3)),a}(t,!1)}});this.container.dispatchEvent(e)}},t.prototype.closePicks=function(){var s=this;this._picks.length===this._level&&(this._picks.forEach(function(t,e){s.board.children[s._picks[e]].innerHTML=s.EMPTY}),this._requestClose=!1,this._picks=new Array)},t}();